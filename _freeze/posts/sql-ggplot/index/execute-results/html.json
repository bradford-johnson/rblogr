{
  "hash": "fcdd90df85a7585cf474444adc1e4a46",
  "result": {
    "markdown": "---\ntitle: \"Airline Tweet Sentiment Database\"\nauthor: \"Bradford Johnson\"\nformat:\n  html:\n   code-fold: true\n   highlight-style: github\neditor: visual\ndate: \"10-1-2022\"\nimage: \"karl-kohler-a80xLtm_tMQ-unsplash.jpg\"\ncategories: [quarto, SQL, ggplot2]\n---\n\n\nUsing SQL to query a database then visualizing in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DBI)\nlibrary(RPostgres)\nlibrary(tidyverse)\nlibrary(tidytext)\nlibrary(strainerr)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- dbSendQuery(con, \"\n\n  SELECT airline, COUNT(negativereason) as n_tweets\n  FROM codedtweets\n  GROUP BY airline\n  ORDER BY n_tweets DESC;\n                   \n                   \")\n\nairline_df <- dbFetch(res)\ndbClearResult(res)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolors_df <-c(\"#003f5c\",\"#58508d\",\"#bc5090\",\"#ff6361\",\"#ffa600\")\np1 <- airline_df %>%\n  mutate(n_tweets = as.numeric(n_tweets), \n         airline = factor(airline, levels = c(\"United\",\n                                              \"US Airways\",\n                                              \"Southwest\",\n                                              \"Delta\",\n                                              \"Virgin America\"))) %>%\n  ggplot(aes(x=airline, y=n_tweets, fill=colors_df, label=n_tweets)) +\n  geom_col() +\n  geom_label(colour=\"white\",nudge_y = 120, alpha = .7)\n  \np1 <- titlr(p1, \"Negative Tweets by Airline\", \"\", \"Count of Tweets\")\n\np1 <- p1 + scale_fill_manual(values = colors_df) + theme_classic()\n\np1 <- p1 + theme(legend.position = \"\", axis.text.x = element_text(face = \"bold\"))\n\np1\n```\n\n::: {.cell-output-display}\n![Breakdown of negative Tweets by airline](index_files/figure-html/fig-airline-1-1.png){#fig-airline-1 width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- dbSendQuery(con, \"\n\n  -- Breakdown by airline and reason\n  SELECT airline, negativereason, COUNT(negativereason) as n_tweets\n  FROM codedtweets\n  GROUP BY airline, negativereason\n  HAVING(COUNT(negativereason)) > 0\n  ORDER BY airline ASC, n_tweets DESC;\n                   \n                   \")\n\nairline_reason_df <- dbFetch(res)\ndbClearResult(res)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- airline_reason_df %>%\n  mutate(n_tweets = as.numeric(n_tweets), \n         airline = factor(airline, levels = c(\"United\",\n                                              \"US Airways\",\n                                              \"Southwest\",\n                                              \"Delta\",\n                                              \"Virgin America\")),\n         negativereason = case_when(negativereason == \"Customer Service Issue\" ~ \"CX\",\n                                    negativereason == \"Can\\'t Tell\" ~ \"Unknown\",\n                                    negativereason == \"Bad Flight\" ~ \"FX\",\n                                    negativereason == \"Flight Attendant Complaints\" ~ \"FX\",\n                                    negativereason == \"Cancelled Flight\" ~ \"FX\", \n                                    negativereason == \"Flight Booking Problems\" ~ \"CX\",\n                                    negativereason == \"longlines\" ~ \"CX\",\n                                    negativereason == \"Late Flight\" ~ \"FX\",\n                                    negativereason == \"Lost Luggage\" ~ \"Luggage Issue\",\n                                    negativereason == \"Damaged Luggage\" ~ \"Luggage Issue\")) %>%\n  ggplot(aes(x=negativereason, y=n_tweets, fill=airline, label=n_tweets)) +\n  geom_col(position = \"dodge\") \n  \np2 <- titlr(p2, \"Negative Tweet Topic by Airline\", \"\", \"Count of Tweets\")\n\np2 <- p2 + scale_fill_manual(values=colors_df) + theme_classic()\n\np2 <- p2 + theme(legend.position = \"right\", legend.box.spacing = unit(.4,\"cm\") ,legend.title = element_blank(),legend.key.size = unit(.4,\"cm\"), axis.text.x = element_text(angle = 0, vjust = .4, face = \"bold\"))\n\np2 \n```\n\n::: {.cell-output-display}\n![Breakdown of negative Tweet topic by Airline](index_files/figure-html/fig-airline-2-1.png){#fig-airline-2 width=672}\n:::\n:::\n\n\n> *CX = Customer Experience*\n>\n> *FX = Flight Experience*\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}